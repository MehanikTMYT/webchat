const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ChatView-DF7PrnhN.js","./vendor-CHByjYQ3.js","./ChatView-BKKanATw.css","./CharacterView-DtRGdxNg.js","./CharacterView-CHITOPqX.css","./DashboardView-CgIJZ_y7.js","./DashboardView-DbmTkFCm.css","./LoginView-C9fjU04Q.js","./LoginView-CxEPcMUR.css","./RegisterView-xDC9rqwo.js","./RegisterView-BKKFjnxz.css","./SettingsView-BK1f8YST.js","./SettingsView-DeqWCFPY.css","./NotFoundView-D0QYEnSe.js","./NotFoundView-CY7UEj_e.css"])))=>i.map(i=>d[i]);
import{d as e,r as t,c as a,a as n,o,b as s,t as i,e as r,w as l,f as c,g as u,n as d,h as m,i as v,j as h,k as p,u as g,l as f,m as w,F as k,p as y,q as _,s as b,v as E,x as S,y as I}from"./vendor-CHByjYQ3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const T=e("auth",()=>{const e=t(localStorage.getItem("chatbot_token")||null),a=t(null),n=t(!!e.value),o=()=>{localStorage.removeItem("chatbot_token"),e.value=null,a.value=null,n.value=!1},s=t=>{e.value=t,localStorage.setItem("chatbot_token",t),n.value=!0};return{token:e,user:a,isAuthenticated:n,login:async(e,t)=>{try{const a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!a.ok)throw new Error("Неверные учетные данные");const n=await a.json();return s(n.access_token),n}catch(a){throw a}},register:async(e,t)=>{try{const a=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!a.ok)throw new Error("Ошибка регистрации");const n=await a.json();return s(n.access_token),n}catch(a){throw a}},logout:o,verifyToken:async()=>{if(!e.value)return!1;try{const t=await fetch("/api/auth/verify",{headers:{Authorization:`Bearer ${e.value}`}});if(t.ok){const e=await t.json();return a.value=e.user,!0}return o(),!1}catch(t){return o(),!1}}}}),L=e("chat",()=>{const e=t([]),a=t([]),n=t(!1),o=async(t,a)=>{try{const n=await fetch(`/api/sessions/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`},body:JSON.stringify({title:a})});if(!n.ok)throw new Error("Не удалось обновить заголовок");const o=await n.json();return e.value=e.value.map(e=>e.id===t?o:e),o}catch(n){throw n}};return{sessions:e,messages:a,loading:n,loadSessions:async()=>{try{n.value=!0;const t=await fetch("/api/sessions",{headers:{Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`}});if(!t.ok)throw new Error("Не удалось загрузить сессии");const a=await t.json();return e.value=a,a}catch(t){throw t}finally{n.value=!1}},createSession:async(t="Новый чат")=>{try{n.value=!0;const a=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`},body:JSON.stringify({title:t})});if(!a.ok)throw new Error("Не удалось создать сессию");const o=await a.json();return e.value.unshift(o),o}catch(a){throw a}finally{n.value=!1}},loadMessages:async e=>{try{n.value=!0;const t=await fetch(`/api/sessions/${e}/messages`,{headers:{Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`}});if(!t.ok)throw new Error("Не удалось загрузить сообщения");const o=await t.json();return a.value=[...a.value,...o.filter(e=>!a.value.some(t=>t.id===e.id))],o}catch(t){throw t}finally{n.value=!1}},sendMessage:async(t,s)=>{try{n.value=!0;const i=await fetch("/api/chat/send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`},body:JSON.stringify({session_id:t,message:s})});if(!i.ok)throw new Error("Не удалось отправить сообщение");const r=await i.json();a.value=[...a.value,{id:Date.now(),session_id:t,role:"user",content:s,created_at:(new Date).toISOString()},{id:Date.now()+1,session_id:t,role:"assistant",content:r.response,created_at:(new Date).toISOString()}];const l=e.value.find(e=>e.id===t);return!l||"Новый чат"!==l.title&&"Untitled Chat"!==l.title||await o(t,`Чат: ${s.substring(0,20)}${s.length>20?"...":""}`),{userMessage:s,botResponse:r.response}}catch(i){throw i}finally{n.value=!1}},updateSessionTitle:o,deleteSession:async t=>{try{n.value=!0;if(!(await fetch(`/api/sessions/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`}})).ok)throw new Error("Не удалось удалить сессию");return e.value=e.value.filter(e=>e.id!==t),a.value=a.value.filter(e=>e.session_id!==t),!0}catch(o){throw o}finally{n.value=!1}},regenerateLastResponse:async e=>{try{n.value=!0;const t=a.value.filter(t=>t.session_id===e),o=t.filter(e=>"user"===e.role).slice(-1)[0];if(!o)throw new Error("Нет сообщений для перегенерации");const s=t.filter(e=>"assistant"===e.role).slice(-1)[0];s&&(a.value=a.value.filter(e=>e.id!==s.id));const i=await fetch("/api/chat/regenerate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`},body:JSON.stringify({session_id:e,message_id:o.id})});if(!i.ok)throw new Error("Не удалось перегенерировать ответ");const r=await i.json();return a.value=[...a.value,{id:Date.now(),session_id:e,role:"assistant",content:r.response,created_at:(new Date).toISOString()}],r.response}catch(t){throw t}finally{n.value=!1}},editMessage:async(e,t)=>{try{n.value=!0;const o=a.value.find(t=>t.id===e);if(!o||"user"!==o.role)throw new Error("Нельзя редактировать это сообщение");if(!(await fetch(`/api/messages/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`},body:JSON.stringify({content:t})})).ok)throw new Error("Не удалось отредактировать сообщение");return a.value=a.value.map(a=>a.id===e?{...a,content:t}:a),t}catch(o){throw o}finally{n.value=!1}},deleteMessage:async e=>{try{n.value=!0;if(!(await fetch(`/api/messages/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("chatbot_token")}`}})).ok)throw new Error("Не удалось удалить сообщение");const t=a.value.findIndex(t=>t.id===e);return-1!==t&&(a.value=a.value.slice(0,t)),!0}catch(t){throw t}finally{n.value=!1}}}}),C=e("network",()=>{const e=t(navigator.onLine),n=t(navigator.connection?.effectiveType||"unknown"),o=t(navigator.connection?.downlink||0),s=t(navigator.connection?.rtt||0),i=t(new Date),r=t("checking"),l=t(0),c=a(()=>e.value?l.value>500||o.value<1?"poor":l.value>200||o.value<5?"fair":"good":"offline"),u=a(()=>o.value<2||s.value>300),d=a(()=>{if(!e.value)return"Офлайн";return{offline:"Нет подключения",poor:"Плохое соединение",fair:"Удовлетворительное соединение",good:"Хорошее соединение"}[c.value]||"Проверка соединения..."}),m=()=>{navigator.connection&&(n.value=navigator.connection.effectiveType,o.value=navigator.connection.downlink,s.value=navigator.connection.rtt)},v=async()=>{try{const e=Date.now(),t=(await fetch("/api/health",{method:"GET",mode:"no-cors",cache:"no-cache",timeout:5e3}),Date.now());return l.value=t-e,r.value="connected",i.value=new Date,!0}catch(e){return r.value="disconnected",!1}},h=()=>{e.value=!0,i.value=new Date,v()},p=()=>{e.value=!1,r.value="offline"};return{isOnline:e,connectionType:n,downlink:o,rtt:s,pingLatency:l,connectionStatus:r,lastOnlineCheck:i,connectionQuality:c,isSlowConnection:u,getStatusText:d,updateConnectionInfo:m,checkConnection:v,initialize:()=>{window.addEventListener("online",h),window.addEventListener("offline",p),navigator.connection&&navigator.connection.addEventListener("change",m);const t=setInterval(()=>{e.value&&v()},3e4);return v(),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",p),navigator.connection&&navigator.connection.removeEventListener("change",m),clearInterval(t)}},forceReconnect:async()=>{r.value="reconnecting";const e=await v();return r.value=e?"connected":"disconnected",e},getNetworkInfo:()=>({isOnline:e.value,connectionType:n.value,downlink:o.value,rtt:s.value,pingLatency:l.value,connectionQuality:c.value,lastCheck:i.value,status:r.value})}}),O=(e,t)=>{const a=e.__vccOpts||e;for(const[n,o]of t)a[n]=o;return a},A={class:"network-status"};const D=O({},[["render",function(e,t){return o(),n("div",A,[...t[0]||(t[0]=[s("span",{class:"status-indicator online"},null,-1),s("span",{class:"status-text"},"Онлайн",-1)])])}],["__scopeId","data-v-37180a23"]]),M={class:"material-icons"},$=O({__name:"ThemeToggle",props:{isDarkMode:Boolean},emits:["toggle"],setup(e,{emit:t}){const a=t,r=()=>{a("toggle")};return(t,a)=>(o(),n("button",{class:"theme-toggle",onClick:r},[s("i",M,i(e.isDarkMode?"light_mode":"dark_mode"),1)]))}},[["__scopeId","data-v-dba04cb5"]]),j={class:"menu-content"},P={class:"menu-items"},z=O({__name:"MobileMenu",props:{isOpen:Boolean},emits:["close","logout","new-chat"],setup(e,{emit:t}){const a=t,i=()=>{a("close")},m=()=>{a("logout"),i()};return(t,a)=>{const v=c("router-link");return o(),n("div",{class:d(["mobile-menu",{open:e.isOpen}])},[s("div",j,[s("div",{class:"menu-header"},[a[1]||(a[1]=s("h3",{class:"menu-title"},"Меню",-1)),s("button",{class:"menu-close",onClick:i},[...a[0]||(a[0]=[s("i",{class:"material-icons"},"close",-1)])])]),s("div",P,[r(v,{to:"/chat",class:"menu-item",onClick:i},{default:l(()=>[...a[2]||(a[2]=[s("i",{class:"material-icons"},"chat",-1),u(" Чат ",-1)])]),_:1}),r(v,{to:"/characters",class:"menu-item",onClick:i},{default:l(()=>[...a[3]||(a[3]=[s("i",{class:"material-icons"},"person",-1),u(" Персонажи ",-1)])]),_:1}),r(v,{to:"/settings",class:"menu-item",onClick:i},{default:l(()=>[...a[4]||(a[4]=[s("i",{class:"material-icons"},"settings",-1),u(" Настройки ",-1)])]),_:1}),s("button",{class:"menu-item logout-item",onClick:m},[...a[5]||(a[5]=[s("i",{class:"material-icons"},"logout",-1),u(" Выход ",-1)])])])])],2)}}},[["__scopeId","data-v-1cc706b8"]]),B=e("theme",()=>{const e=t(!1),n=t(!1),o=a(()=>window.matchMedia("(prefers-color-scheme: dark)").matches),s=()=>{const t=localStorage.getItem("darkMode");null!==t?e.value="true"===t:(e.value=o.value,n.value=!0),i(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{n.value&&(e.value=t.matches,i())})},i=()=>{e.value?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};return m(()=>{s()}),{isDarkMode:e,prefersDark:n,systemPrefersDark:o,initializeTheme:s,toggleTheme:()=>{n.value&&(n.value=!1),e.value=!e.value,localStorage.setItem("darkMode",String(e.value)),i()},setTheme:t=>{n.value=!1,e.value=t,localStorage.setItem("darkMode",String(t)),i()},resetToSystem:()=>{n.value=!0,e.value=o.value,localStorage.removeItem("darkMode"),i()},getThemeState:()=>({isDarkMode:e.value,isSystemPreference:n.value,systemTheme:o.value?"dark":"light"}),updateDocumentTheme:i}}),N={class:"header"},q={class:"container flex items-center justify-between h-full"},x={class:"logo flex items-center gap-2"},V={class:"header-actions flex items-center gap-3"},R={class:"desktop-nav hidden-mobile"},U={class:"nav-list flex gap-4"},J={class:"status-text hidden-mobile"},Q=["aria-label"],F={class:"material-icons theme-icon"},G={key:0,class:"user-menu relative"},W={class:"user-name hidden-mobile"},Y={key:0,class:"user-dropdown"},H={class:"dropdown-content"},K={class:"network-details"},X={class:"detail-row"},Z={class:"detail-row"},ee={class:"detail-value"},te={class:"detail-row"},ae={class:"detail-value"},ne={class:"detail-row"},oe={class:"detail-value"},se={class:"detail-row"},ie={class:"detail-value"},re={class:"modal-actions"},le=O({__name:"HeaderBar",setup(e){const k=w(),y=T(),_=C(),b=B(),E=t(!1),S=t(!1),I=t(window.innerWidth<768),L=a(()=>b.isDarkMode),O=a(()=>_.isOnline?"poor"===_.connectionQuality?"status-poor":"fair"===_.connectionQuality?"status-fair":"status-good":"status-offline"),A=a(()=>{if(!_.isOnline)return"Офлайн";return`${{poor:"Плохое",fair:"Среднее",good:"Хорошее"}[_.connectionQuality]||"Хорошее"} соединение`}),D=()=>{b.toggleTheme()},M=()=>{E.value=!E.value},$=async()=>{try{await y.logout(),E.value=!1,k.push("/login")}catch(e){alert("Ошибка при выходе из системы")}},j=()=>{S.value=!S.value},P=async()=>{try{await _.forceReconnect(),le("Переподключение выполнено успешно!","success")}catch(e){le("Ошибка переподключения","error")}},z=()=>{if(!_.lastOnlineCheck)return"Никогда";const e=new Date-new Date(_.lastOnlineCheck),t=Math.floor(e/6e4);if(t<1)return"Только что";if(t<60)return`${t} мин назад`;return`${Math.floor(t/60)} ч назад`},le=(e,t="info")=>{const a=new CustomEvent("notification",{detail:{message:e,type:t}});document.dispatchEvent(a)},ce=()=>{I.value=window.innerWidth<768},ue=()=>{const e=new CustomEvent("toggle-mobile-menu");document.dispatchEvent(e)};return m(()=>{const e=e=>{e.target.closest(".user-menu")||(E.value=!1)};window.addEventListener("click",e),window.addEventListener("resize",ce),_.initialize(),v(()=>{window.removeEventListener("click",e),window.removeEventListener("resize",ce)})}),(e,t)=>{const a=c("router-link");return o(),n("header",N,[s("div",q,[s("div",x,[r(a,{to:"/",class:"logo-link"},{default:l(()=>[...t[3]||(t[3]=[s("div",{class:"logo-icon-container"},[s("i",{class:"material-icons logo-icon"},"smart_toy")],-1),s("span",{class:"logo-text"},"Чат-бот",-1)])]),_:1})]),s("div",V,[s("nav",R,[s("ul",U,[s("li",null,[r(a,{to:"/chat",class:"nav-link"},{default:l(()=>[...t[4]||(t[4]=[s("i",{class:"material-icons"},"chat",-1),s("span",null,"Чат",-1)])]),_:1})]),s("li",null,[r(a,{to:"/characters",class:"nav-link"},{default:l(()=>[...t[5]||(t[5]=[s("i",{class:"material-icons"},"person",-1),s("span",null,"Персонажи",-1)])]),_:1})]),s("li",null,[r(a,{to:"/settings",class:"nav-link"},{default:l(()=>[...t[6]||(t[6]=[s("i",{class:"material-icons"},"settings",-1),s("span",null,"Настройки",-1)])]),_:1})])])]),s("div",{class:"network-status",onClick:j},[s("div",{class:d(["status-indicator",O.value])},null,2),s("span",J,i(A.value),1)]),s("button",{class:"theme-toggle",onClick:D,"aria-label":`Переключить ${L.value?"светлую":"темную"} тему`},[s("i",F,i(L.value?"light_mode":"dark_mode"),1)],8,Q),g(y).isAuthenticated?(o(),n("div",G,[s("button",{class:"user-button",onClick:M},[t[7]||(t[7]=s("div",{class:"user-avatar"},[s("i",{class:"material-icons"},"person")],-1)),s("span",W,i(g(y).user?.username||"Пользователь"),1)]),E.value?(o(),n("div",Y,[t[10]||(t[10]=s("div",{class:"dropdown-arrow"},null,-1)),s("div",H,[r(a,{to:"/settings",class:"dropdown-item"},{default:l(()=>[...t[8]||(t[8]=[s("i",{class:"material-icons"},"settings",-1),u(" Настройки ",-1)])]),_:1}),s("button",{class:"dropdown-item logout-item",onClick:$},[...t[9]||(t[9]=[s("i",{class:"material-icons"},"logout",-1),u(" Выход ",-1)])])])])):h("",!0)])):(o(),p(a,{key:1,to:"/login",class:"login-button"},{default:l(()=>[...t[11]||(t[11]=[s("i",{class:"material-icons"},"login",-1),s("span",{class:"hidden-mobile"},"Вход",-1)])]),_:1})),s("div",{class:"mobile-menu-button block-mobile",onClick:ue},[...t[12]||(t[12]=[s("i",{class:"material-icons"},"menu",-1)])])])]),S.value?(o(),n("div",{key:0,class:"network-modal",onClick:t[2]||(t[2]=e=>S.value=!1)},[s("div",{class:"network-modal-content",onClick:t[1]||(t[1]=f(()=>{},["stop"]))},[t[18]||(t[18]=s("h3",{class:"modal-title"},"Состояние сети",-1)),s("div",K,[s("div",X,[t[13]||(t[13]=s("span",{class:"detail-label"},"Статус:",-1)),s("span",{class:d(["detail-value",O.value])},i(A.value),3)]),s("div",Z,[t[14]||(t[14]=s("span",{class:"detail-label"},"Тип подключения:",-1)),s("span",ee,i(g(_).connectionType||"Неизвестно"),1)]),s("div",te,[t[15]||(t[15]=s("span",{class:"detail-label"},"Скорость:",-1)),s("span",ae,i(g(_).downlink)+" Mbps",1)]),s("div",ne,[t[16]||(t[16]=s("span",{class:"detail-label"},"Задержка:",-1)),s("span",oe,i(g(_).pingLatency)+" мс",1)]),s("div",se,[t[17]||(t[17]=s("span",{class:"detail-label"},"Последняя проверка:",-1)),s("span",ie,i(z()),1)])]),s("div",re,[s("button",{class:"btn btn-primary modal-button",onClick:P}," Переподключиться "),s("button",{class:"btn btn-outline modal-button",onClick:t[0]||(t[0]=e=>S.value=!1)}," Закрыть ")])])])):h("",!0)])}}},[["__scopeId","data-v-a9227353"]]),ce={class:"footer"},ue={class:"container"},de={class:"footer-content text-center py-4"},me={class:"text-secondary"},ve=O({__name:"FooterBar",props:{currentYear:Number},setup:e=>(t,a)=>(o(),n("footer",ce,[s("div",ue,[s("div",de,[s("p",me," © "+i(e.currentYear)+" Гибридный чат-бот. Все права защищены. ",1),a[0]||(a[0]=s("p",{class:"text-secondary text-sm mt-1"}," Версия 1.0.0 | Локальная обработка с приватностью ",-1))])])]))},[["__scopeId","data-v-43c3bbf1"]]),he={key:0,class:"loader-overlay"},pe={class:"main-content"},ge={class:"container"},fe={class:"content-wrapper"},we={key:0,class:"sidebar"},ke={class:"sidebar-header"},ye={class:"sessions-list"},_e=["onClick"],be={class:"session-title"},Ee={class:"session-meta"},Se={class:"session-time"},Ie=["onClick"],Te={class:"sidebar-footer"},Le={class:"network-status"},Ce={class:"theme-toggle"},Oe={},Ae=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};const o=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),i=s?.nonce||s?.getAttribute("nonce");n=e(t.map(e=>{if(e=function(e,t){return new URL(e,t).href}(e,a),e in Oe)return;Oe[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(a)for(let a=o.length-1;a>=0;a--){const n=o[a];if(n.href===e&&(!t||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,i&&s.setAttribute("nonce",i),document.head.appendChild(s),t?new Promise((t,a)=>{s.addEventListener("load",t),s.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)})},De=()=>Ae(()=>import("./ChatView-DF7PrnhN.js"),__vite__mapDeps([0,1,2]),import.meta.url),Me=()=>Ae(()=>import("./CharacterView-DtRGdxNg.js"),__vite__mapDeps([3,1,4]),import.meta.url),$e=[{path:"/",name:"dashboard",component:()=>Ae(()=>import("./DashboardView-CgIJZ_y7.js"),__vite__mapDeps([5,1,6]),import.meta.url),meta:{requiresAuth:!0}},{path:"/chat",name:"chat",component:De,meta:{requiresAuth:!0}},{path:"/chat/:sessionId",name:"chat-session",component:De,meta:{requiresAuth:!0},props:!0},{path:"/characters",name:"characters",component:Me,meta:{requiresAuth:!0}},{path:"/characters/:characterId",name:"character-detail",component:Me,meta:{requiresAuth:!0},props:!0},{path:"/login",name:"login",component:()=>Ae(()=>import("./LoginView-C9fjU04Q.js"),__vite__mapDeps([7,1,8]),import.meta.url),meta:{requiresGuest:!0}},{path:"/register",name:"register",component:()=>Ae(()=>import("./RegisterView-xDC9rqwo.js"),__vite__mapDeps([9,1,10]),import.meta.url),meta:{requiresGuest:!0}},{path:"/settings",name:"settings",component:()=>Ae(()=>import("./SettingsView-BK1f8YST.js"),__vite__mapDeps([11,1,12]),import.meta.url),meta:{requiresAuth:!0}},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>Ae(()=>import("./NotFoundView-D0QYEnSe.js"),__vite__mapDeps([13,1,14]),import.meta.url)}],je=b(O({__name:"App",setup(e){const l=_(),b=w(),E=T(),S=L(),I=C(),O=t(!1),A=t(!1),M=t(!0),j=t(null);m(async()=>{if(A.value="true"===localStorage.getItem("darkMode")||window.matchMedia("(prefers-color-scheme: dark)").matches&&!localStorage.getItem("darkMode"),P(),I.initialize(),E.token)try{await E.verifyToken()}catch(e){E.logout()}if(E.isAuthenticated)try{await S.loadSessions()}catch(e){N("Не удалось загрузить сессии чата","error")}M.value=!1,window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("darkMode")||(A.value=e.matches,P())})}),v(()=>{window.matchMedia("(prefers-color-scheme: dark)").removeEventListener("change",()=>{})});const P=()=>{A.value?(document.documentElement.classList.add("dark"),localStorage.setItem("darkMode","true")):(document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode","false"))},B=()=>{A.value=!A.value,P()},N=(e,t="info")=>{j.value={message:e,type:t,id:Date.now()},setTimeout(()=>{j.value=null},5e3)},q=async()=>{try{await E.logout(),b.push("/login"),N("Вы успешно вышли из системы")}catch(e){N("Ошибка при выходе из системы","error")}},x=a(()=>["login","register","not-found"].includes(l.name)),V=a(()=>x.value||O.value),R=a(()=>(new Date).getFullYear()),U=()=>{O.value=!O.value};return(e,t)=>{const a=c("router-view");return o(),n("div",{class:d(["app-container",{dark:A.value}])},[M.value?(o(),n("div",he,[...t[2]||(t[2]=[s("div",{class:"loader"},null,-1)])])):h("",!0),j.value?(o(),n("div",{key:1,class:d(["notification",j.value.type])},i(j.value.message),3)):h("",!0),r(le,{"is-authenticated":g(E).isAuthenticated,user:g(E).user,"is-mobile-menu-open":O.value,onToggleMobileMenu:U,onLogout:q},null,8,["is-authenticated","user","is-mobile-menu-open"]),s("main",pe,[s("div",ge,[s("div",fe,[g(E).isAuthenticated&&!V.value?(o(),n("aside",we,[s("div",ke,[t[4]||(t[4]=s("h2",{class:"sidebar-title"},"Чаты",-1)),s("button",{class:"new-chat-btn",onClick:t[0]||(t[0]=e=>g(S).createSession())},[...t[3]||(t[3]=[s("i",{class:"material-icons"},"add",-1),u(" Новый чат ",-1)])])]),s("div",ye,[(o(!0),n(k,null,y(g(S).sessions,a=>(o(),n("div",{key:a.id,class:d(["session-item",{active:a.id===e.$route.params.sessionId}]),onClick:e=>g(b).push(`/chat/${a.id}`)},[s("div",be,i(a.title||"Новый чат"),1),s("div",Ee,[s("span",Se,i(new Date(a.updated_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),1),s("button",{class:"delete-session",onClick:f(e=>g(S).deleteSession(a.id),["stop"])},[...t[5]||(t[5]=[s("i",{class:"material-icons"},"close",-1)])],8,Ie)])],10,_e))),128))]),s("div",Te,[s("div",Le,[r(D)]),s("div",Ce,[r($,{"is-dark-mode":A.value,onToggle:B},null,8,["is-dark-mode"])])])])):h("",!0),s("div",{class:d(["content-area",{"full-width":!g(E).isAuthenticated||V.value}])},[(o(),p(a,{key:e.$route.fullPath,onNotification:N}))],2)])])]),g(E).isAuthenticated?(o(),p(z,{key:2,"is-open":O.value,onClose:U,onLogout:q,onNewChat:t[1]||(t[1]=e=>g(S).createSession())},null,8,["is-open"])):h("",!0),r(ve,{"current-year":R.value},null,8,["current-year"])],2)}}},[["__scopeId","data-v-ef6a8c03"]])),Pe=E();je.use(Pe),je.config.globalProperties.$api={baseUrl:"/api/",wsBaseUrl:"ws://localhost:8050/ws/"};const ze=()=>localStorage.getItem("chatbot_token"),Be=S({history:I(),routes:$e});Be.beforeEach((e,t,a)=>{const n=ze();e.meta.requiresAuth&&!n?a({name:"login",query:{redirect:e.fullPath}}):e.meta.requiresGuest&&n?a({name:"chat"}):a()}),je.config.errorHandler=(e,t,a)=>{},window.addEventListener("unhandledrejection",e=>{e.preventDefault()}),je.use(Be);(async()=>{const e=ze();if(e)try{const t=await fetch(`${je.config.globalProperties.$api.baseUrl}auth/refresh`,{method:"POST",headers:{Authorization:`Bearer ${e}`},credentials:"include"});if(t.ok){const e=await t.json();localStorage.setItem("chatbot_token",e.access_token)}else localStorage.removeItem("chatbot_token")}catch(t){localStorage.removeItem("chatbot_token")}je.mount("#app")})(),window.addEventListener("online",()=>{}),window.addEventListener("offline",()=>{});export{O as _,L as a,C as b,B as c,T as u};
