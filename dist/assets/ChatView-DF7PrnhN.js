import{r as e,q as a,c as s,h as t,m as l,i as n,B as i,a as c,o,b as r,j as u,t as d,e as v,g as m,w as g,T as p,z as b,A as h,C as y,l as f,n as k,D as w,F as x,p as C}from"./vendor-CHByjYQ3.js";import{_,a as I,u as M,b as E,c as L}from"./index-yKdpQjmR.js";const S={class:"chat-container flex flex-col h-full"},T={class:"chat-header p-4 border-b border-border-color"},$={class:"flex items-center justify-between"},j={class:"flex items-center gap-3"},D={class:"text-xl font-bold flex items-center gap-2"},H={class:"session-title"},F={class:"flex gap-2"},K=["disabled"],z={key:0,class:"flex justify-center py-8"},q={key:1,class:"empty-state text-center py-12"},A={class:"flex flex-col sm:flex-row justify-center gap-3"},R={class:"message-content"},V={class:"message-header"},W={class:"message-sender"},B={class:"message-time"},N=["innerHTML"],O={class:"message-footer"},U={key:0,class:"message-actions"},G=["onClick"],J=["onClick"],P=["onClick"],Q={key:1,class:"message-actions"},X=["onClick"],Y=["onClick"],Z=["onClick"],ee={key:2,class:"message message-assistant"},ae={class:"message-content"},se={class:"message-header"},te={class:"message-time"},le={key:3,class:"message message-error"},ne={class:"message-content"},ie={class:"message-body"},ce={class:"chat-input p-4 border-t border-border-color"},oe={class:"input-container"},re=["onKeypress"],ue={class:"input-actions"},de=["disabled"],ve={key:0,class:"char-counter"},me=2e3,ge=_({__name:"ChatView",setup(_){const ge=a(),pe=l(),be=I(),he=M(),ye=E();L();const fe=e(ge.params.sessionId||null),ke=e(""),we=e(!1),xe=e(!0),Ce=e(null),_e=e(null),Ie=e(null),Me=e(window.innerWidth<768),Ee=e((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),Le=s(()=>be.sessions.find(e=>e.id===fe.value)),Se=s(()=>be.messages.filter(e=>e.session_id===fe.value).map(e=>({...e,feedback:be.messageFeedback[e.id]||null}))),Te=s(()=>ke.value.trim().length>0&&ke.value.trim().length<=me&&!we.value&&ye.isOnline),$e=e=>{const a=e.target;a.style.height="auto",a.style.height=`${Math.min(a.scrollHeight,200)}px`,_e.value&&(_e.value=null)},je=e=>{"Escape"===e.key&&(ke.value=""),"Enter"===e.key&&e.shiftKey&&(e.preventDefault(),ke.value+="\n")},De=e=>{if(!e)return"";return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},He=e=>{if(!e)return"";let a=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,'<code class="inline-code">$1</code>').replace(/\n/g,"<br>");return a=a.replace(/https?:\/\/[^\s]+/g,e=>`<a href="${e}" target="_blank" rel="noopener noreferrer" class="message-link">${e}</a>`),a},Fe=(e=!1)=>{Ce.value&&Ce.value.scrollTo({top:Ce.value.scrollHeight,behavior:e?"smooth":"auto"})},Ke=async()=>{if(!Te.value)return;const e=ke.value.trim();if(e.length>me)_e.value="Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð´Ð»Ð¸Ð½Ð½Ð¾Ðµ (Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 2000 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²)";else{ke.value="",Ie.value={type:"send_message",sessionId:fe.value,message:e};try{if(we.value=!0,_e.value=null,!fe.value){const e=await be.createSession();fe.value=e.id,pe.push({name:"chat-session",params:{sessionId:fe.value}})}await be.sendMessage(fe.value,e),await w(),Fe(!0)}catch(a){_e.value="ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ: "+(a.message||"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ"),(a.message?.includes("Network Error")||a.message?.includes("Failed to fetch"))&&await be.removeLastMessage(fe.value)}finally{we.value=!1}}},ze=async()=>{try{const e=await be.createSession();fe.value=e.id,pe.push({name:"chat-session",params:{sessionId:fe.value}}),ke.value="",_e.value=null}catch(e){_e.value="ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð½Ð¾Ð²Ð¾Ð¹ ÑÐµÑÑÐ¸Ð¸"}},qe=async e=>{ke.value=e,await w(),Ke()},Ae=async()=>{if(Le.value&&0!==Se.value.length&&!we.value)try{we.value=!0,_e.value=null,Ie.value={type:"regenerate",sessionId:fe.value},await be.regenerateLastResponse(fe.value),await w(),Fe(!0)}catch(e){_e.value="ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿ÐµÑ€ÐµÐ³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð°: "+(e.message||"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ")}finally{we.value=!1}},Re=async(e,a)=>{try{await be.setMessageFeedback(e,a)}catch(s){}},Ve=async e=>{try{await navigator.clipboard.writeText(e),We("Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð² Ð±ÑƒÑ„ÐµÑ€ Ð¾Ð±Ð¼ÐµÐ½Ð°!","success")}catch(a){We("ÐžÑˆÐ¸Ð±ÐºÐ° ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ","error")}},We=(e,a="info")=>{const s=new CustomEvent("notification",{detail:{message:e,type:a}});document.dispatchEvent(s)},Be=async()=>{if(Ie.value)try{switch(we.value=!0,_e.value=null,Ie.value.type){case"send_message":await be.sendMessage(Ie.value.sessionId,Ie.value.message);break;case"regenerate":await be.regenerateLastResponse(Ie.value.sessionId);break;case"edit_message":await be.editMessage(Ie.value.messageId,Ie.value.newContent);break;case"delete_message":await be.deleteMessage(Ie.value.messageId)}await w(),Fe(!0)}catch(e){_e.value="ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ: "+(e.message||"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ")}finally{we.value=!1}},Ne=()=>{pe.push("/")},Oe=()=>{We("ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸","info")},Ue=()=>{Me.value=window.innerWidth<768};return t(async()=>{if(!he.isAuthenticated)return void pe.push("/login");try{if(xe.value=!0,await be.loadSessions(),fe.value)await be.loadMessages(fe.value);else{const e=await be.createSession();fe.value=e.id,pe.replace({name:"chat-session",params:{sessionId:fe.value}})}}catch(a){_e.value="ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ‡Ð°Ñ‚Ð°: "+(a.message||"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ")}finally{xe.value=!1,Fe()}const e=setInterval(()=>{Ee.value=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},6e4);window.addEventListener("resize",Ue),n(()=>{clearInterval(e),window.removeEventListener("resize",Ue)})}),i(Se,()=>{w(()=>{Fe()})}),i(ke,e=>{w(()=>{const e=document.querySelector(".input-field");e&&(e.style.height="auto",e.style.height=`${Math.min(e.scrollHeight,200)}px`)})}),(e,a)=>(o(),c("div",S,[r("div",T,[r("div",$,[r("div",j,[Me.value?(o(),c("button",{key:0,class:"back-button",onClick:Ne},[...a[3]||(a[3]=[r("i",{class:"material-icons"},"arrow_back",-1)])])):u("",!0),r("h1",D,[a[4]||(a[4]=r("i",{class:"material-icons"},"chat",-1)),r("span",H,d(Le.value?.title||"ÐÐ¾Ð²Ñ‹Ð¹ Ñ‡Ð°Ñ‚"),1)])]),r("div",F,[r("button",{class:"btn btn-outline action-button",onClick:Ae,disabled:we.value||0===Se.value.length,title:"ÐŸÐµÑ€ÐµÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚"},[...a[5]||(a[5]=[r("i",{class:"material-icons"},"refresh",-1),r("span",{class:"hidden-mobile"},"ÐŸÐµÑ€ÐµÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",-1)])],8,K),r("button",{class:"btn btn-outline action-button",onClick:ze,title:"ÐÐ¾Ð²Ñ‹Ð¹ Ñ‡Ð°Ñ‚"},[...a[6]||(a[6]=[r("i",{class:"material-icons"},"add",-1),r("span",{class:"hidden-mobile"},"ÐÐ¾Ð²Ñ‹Ð¹ Ñ‡Ð°Ñ‚",-1)])])])])]),r("div",{class:"chat-messages flex-1 overflow-y-auto p-4",ref_key:"messagesContainer",ref:Ce},[xe.value?(o(),c("div",z,[...a[7]||(a[7]=[r("div",{class:"loader"},null,-1)])])):0!==Se.value.length||xe.value?u("",!0):(o(),c("div",q,[a[10]||(a[10]=r("div",{class:"text-5xl mb-4 animate-bounce"},"ðŸ’¬",-1)),a[11]||(a[11]=r("h3",{class:"text-xl font-semibold mb-2"},"ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð´Ð¸Ð°Ð»Ð¾Ð³",-1)),a[12]||(a[12]=r("p",{class:"text-secondary mb-4"},"Ð—Ð°Ð´Ð°Ð¹Ñ‚Ðµ Ð²Ð°Ñˆ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ, Ð¸ Ñ Ð¿Ð¾ÑÑ‚Ð°Ñ€Ð°ÑŽÑÑŒ Ð²Ð°Ð¼ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ!",-1)),r("div",A,[r("button",{class:"btn btn-primary example-btn",onClick:a[0]||(a[0]=e=>qe("ÐŸÑ€Ð¸Ð²ÐµÑ‚! ÐšÐ°Ðº Ñ Ð¼Ð¾Ð³Ñƒ Ð²Ð°Ð¼ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?"))},[...a[8]||(a[8]=[r("i",{class:"material-icons mr-1"},"handshake",-1),m(" ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ ",-1)])]),r("button",{class:"btn btn-outline example-btn",onClick:a[1]||(a[1]=e=>qe("Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¾ ÑÐµÐ±Ðµ Ð¸ Ñ‚Ð²Ð¾Ð¸Ñ… Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑÑ…."))},[...a[9]||(a[9]=[r("i",{class:"material-icons mr-1"},"info",-1),m(" Ðž Ð±Ð¾Ñ‚Ðµ ",-1)])])])])),v(p,{name:"message-list",tag:"div"},{default:g(()=>[(o(!0),c(x,null,C(Se.value,(e,s)=>(o(),c("div",{key:e.id,class:"message-group mb-4"},[r("div",{class:k(["message",{"message-user":"user"===e.role,"message-assistant":"assistant"===e.role,"message-error":e.error}])},[r("div",R,[r("div",V,[r("i",{class:k(["material-icons",{"text-primary":"user"===e.role,"text-secondary":"assistant"===e.role}])},d("user"===e.role?"person":"smart_toy"),3),r("span",W,d("user"===e.role?"Ð’Ñ‹":"ÐÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚"),1),r("span",B,d(De(e.created_at)),1)]),r("div",{class:k(["message-body",{"message-markdown":"assistant"===e.role}]),innerHTML:He(e.content)},null,10,N),r("div",O,["user"!==e.role||we.value?u("",!0):(o(),c("div",U,[r("button",{class:"message-action copy-btn",onClick:a=>Ve(e.content),title:"ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ"},[...a[13]||(a[13]=[r("i",{class:"material-icons"},"content_copy",-1)])],8,G),r("button",{class:"message-action edit-btn",onClick:a=>(async e=>{if("user"!==e.role||we.value)return;const a=prompt("Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ:",e.content);if(a&&""!==a.trim()&&a!==e.content)try{we.value=!0,_e.value=null,Ie.value={type:"edit_message",sessionId:fe.value,messageId:e.id,oldContent:e.content,newContent:a},await be.editMessage(e.id,a.trim()),await w(),Fe(!0)}catch(s){_e.value="ÐžÑˆÐ¸Ð±ÐºÐ° Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ: "+(s.message||"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ")}finally{we.value=!1}})(e),title:"Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ"},[...a[14]||(a[14]=[r("i",{class:"material-icons"},"edit",-1)])],8,J),r("button",{class:"message-action delete-btn",onClick:a=>(async e=>{if(!we.value&&confirm("Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¸ Ð²ÑÐµ Ð¿Ð¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ?"))try{we.value=!0,_e.value=null,Ie.value={type:"delete_message",sessionId:fe.value,messageId:e.id},await be.deleteMessage(e.id),await w(),Fe()}catch(a){_e.value="ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ: "+(a.message||"ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ")}finally{we.value=!1}})(e),title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ"},[...a[15]||(a[15]=[r("i",{class:"material-icons"},"delete",-1)])],8,P)])),"assistant"!==e.role||we.value?u("",!0):(o(),c("div",Q,[r("button",{class:"message-action copy-btn",onClick:a=>Ve(e.content),title:"ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚"},[...a[16]||(a[16]=[r("i",{class:"material-icons"},"content_copy",-1)])],8,X),r("button",{class:k(["message-action like-btn",{active:"positive"===e.feedback}]),onClick:a=>Re(e.id,"positive"),title:"ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚"},[...a[17]||(a[17]=[r("i",{class:"material-icons"},"thumb_up",-1)])],10,Y),r("button",{class:k(["message-action dislike-btn",{active:"negative"===e.feedback}]),onClick:a=>Re(e.id,"negative"),title:"ÐÐµ Ð¿Ð¾Ð»ÐµÐ·Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚"},[...a[18]||(a[18]=[r("i",{class:"material-icons"},"thumb_down",-1)])],10,Z)]))])])],2)]))),128))]),_:1}),we.value?(o(),c("div",ee,[r("div",ae,[r("div",se,[a[19]||(a[19]=r("i",{class:"material-icons text-secondary"},"smart_toy",-1)),a[20]||(a[20]=r("span",null,"ÐÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚",-1)),r("span",te,d(Ee.value),1)]),a[21]||(a[21]=r("div",{class:"message-body typing-indicator"},[r("span"),r("span"),r("span")],-1))])])):u("",!0),_e.value?(o(),c("div",le,[r("div",ne,[a[22]||(a[22]=r("div",{class:"message-header"},[r("i",{class:"material-icons text-danger"},"error"),r("span",{class:"text-danger"},"ÐžÑˆÐ¸Ð±ÐºÐ°")],-1)),r("div",ie,d(_e.value),1),r("div",{class:"message-footer"},[r("button",{class:"btn btn-sm btn-danger retry-btn",onClick:Be}," ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÑƒ ")])])])):u("",!0)],512),r("div",ce,[r("div",oe,[b(r("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>ke.value=e),class:"input-field",placeholder:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ... (Enter Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸, Shift+Enter Ð´Ð»Ñ Ð½Ð¾Ð²Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸)",rows:"1",onKeypress:y(f(Ke,["exact","prevent"]),["enter"]),onInput:$e,onKeydown:je},null,40,re),[[h,ke.value]]),r("div",ue,[r("button",{class:"action-button attachment-btn",onClick:Oe,title:"ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»"},[...a[23]||(a[23]=[r("i",{class:"material-icons"},"attach_file",-1)])]),r("button",{class:k(["send-button",{"send-button-active":Te.value}]),onClick:Ke,disabled:!Te.value,title:"ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ (Enter)"},[...a[24]||(a[24]=[r("i",{class:"material-icons"},"send",-1)])],10,de)])]),ke.value.length>0?(o(),c("div",ve,d(ke.value.length)+"/"+d(me),1)):u("",!0)])]))}},[["__scopeId","data-v-7bfff8a5"]]);export{ge as default};
