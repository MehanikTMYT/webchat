import{r as s,h as e,a,o as t,b as l,g as o,t as i,u as n,z as c,E as r,G as d,F as m,p as u,j as v,m as h}from"./vendor-CHByjYQ3.js";import{_ as g,u as p,a as b}from"./index-yKdpQjmR.js";const f={class:"settings-container"},k={class:"card"},y={class:"card-body"},w={class:"settings-section"},S={class:"form-group"},C={class:"settings-value"},_={class:"form-group"},E={class:"settings-value"},U={class:"settings-section"},I={class:"form-group"},L={class:"flex gap-4 mt-2"},j={class:"theme-option"},x={class:"theme-option"},O={class:"theme-option"},V={class:"settings-section"},M={class:"form-group"},R={class:"switch"},$={class:"form-group"},z={class:"switch"},B={class:"settings-section"},D={class:"form-group"},A={class:"active-sessions"},J={class:"session-info"},N={class:"session-device"},T={class:"session-ip"},F={class:"session-time"},G=["onClick"],P=g({__name:"SettingsView",setup(g){const P=p(),q=b();h();const H=s("system"),K=s({sound:!0,messages:!0}),Q=s([]);s(!1),e(async()=>{W(),await X()});const W=()=>{const s=localStorage.getItem("darkMode");null!==s&&(H.value="true"===s?"dark":"false"===s?"light":"system");const e=JSON.parse(localStorage.getItem("chatbot_notifications")||"{}");K.value={sound:void 0===e.sound||e.sound,messages:void 0===e.messages||e.messages}},X=async()=>{try{const s=await fetch("/api/auth/sessions",{headers:{Authorization:`Bearer ${P.token}`}});if(s.ok){const e=await s.json();Q.value=e.map(s=>({...s,current:s.session_id===localStorage.getItem("chatbot_session_id")}))}}catch(s){}},Y=()=>{const s=window.matchMedia("(prefers-color-scheme: dark)").matches;"system"===H.value?(document.documentElement.classList.toggle("dark",s),localStorage.removeItem("darkMode")):"dark"===H.value?(document.documentElement.classList.add("dark"),localStorage.setItem("darkMode","true")):(document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode","false"))},Z=()=>{localStorage.setItem("chatbot_notifications",JSON.stringify(K.value))},ss=s=>{if(!s)return"";return new Date(s).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},es=()=>{alert("Функция изменения пароля будет доступна в следующем обновлении")},as=()=>{if(confirm("Вы хотите скачать все ваши данные, включая историю чатов?"))try{const s={user:P.user,sessions:q.sessions,messages:q.messages},e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download=`chatbot-data-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a),alert("Данные успешно экспортированы")}catch(s){alert("Ошибка при экспорте данных")}},ts=async()=>{if(confirm("Вы уверены, что хотите удалить ВСЮ историю чатов? Это действие нельзя отменить."))try{if(!(await fetch("/api/chat/clear-history",{method:"POST",headers:{Authorization:`Bearer ${P.token}`}})).ok)throw new Error("Не удалось очистить историю");q.messages=[],q.sessions=[],await q.loadSessions(),alert("История чатов успешно очищена")}catch(s){alert("Ошибка при очистке истории")}};return(s,e)=>(t(),a("div",f,[l("div",k,[e[31]||(e[31]=l("div",{class:"card-header"},[l("h2",{class:"text-2xl font-bold flex items-center gap-2"},[l("i",{class:"material-icons"},"settings"),o(" Настройки ")])],-1)),l("div",y,[l("div",w,[e[7]||(e[7]=l("h3",{class:"settings-section-title"},"Профиль",-1)),l("div",S,[e[5]||(e[5]=l("label",{class:"form-label"},"Имя пользователя",-1)),l("div",C,i(n(P).user?.username||"Не указано"),1)]),l("div",_,[e[6]||(e[6]=l("label",{class:"form-label"},"Дата регистрации",-1)),l("div",E,i(ss(n(P).user?.created_at)||"Неизвестно"),1)])]),l("div",U,[e[15]||(e[15]=l("h3",{class:"settings-section-title"},"Внешний вид",-1)),l("div",I,[e[14]||(e[14]=l("label",{class:"form-label"},"Тема",-1)),l("div",L,[l("label",j,[c(l("input",{type:"radio",name:"theme",value:"system","onUpdate:modelValue":e[0]||(e[0]=s=>H.value=s),onChange:Y},null,544),[[r,H.value]]),e[8]||(e[8]=l("div",{class:"theme-preview system"},[l("div",{class:"theme-preview-light"}),l("div",{class:"theme-preview-dark"})],-1)),e[9]||(e[9]=l("span",null,"Системная",-1))]),l("label",x,[c(l("input",{type:"radio",name:"theme",value:"light","onUpdate:modelValue":e[1]||(e[1]=s=>H.value=s),onChange:Y},null,544),[[r,H.value]]),e[10]||(e[10]=l("div",{class:"theme-preview light"},[l("div",{class:"theme-preview-content"})],-1)),e[11]||(e[11]=l("span",null,"Светлая",-1))]),l("label",O,[c(l("input",{type:"radio",name:"theme",value:"dark","onUpdate:modelValue":e[2]||(e[2]=s=>H.value=s),onChange:Y},null,544),[[r,H.value]]),e[12]||(e[12]=l("div",{class:"theme-preview dark"},[l("div",{class:"theme-preview-content"})],-1)),e[13]||(e[13]=l("span",null,"Темная",-1))])])])]),l("div",V,[e[20]||(e[20]=l("h3",{class:"settings-section-title"},"Уведомления",-1)),l("div",M,[e[17]||(e[17]=l("label",{class:"form-label"},"Звуковые уведомления",-1)),l("label",R,[c(l("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>K.value.sound=s),onChange:Z},null,544),[[d,K.value.sound]]),e[16]||(e[16]=l("span",{class:"slider"},null,-1))])]),l("div",$,[e[19]||(e[19]=l("label",{class:"form-label"},"Уведомления о новых сообщениях",-1)),l("label",z,[c(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=s=>K.value.messages=s),onChange:Z},null,544),[[d,K.value.messages]]),e[18]||(e[18]=l("span",{class:"slider"},null,-1))])])]),l("div",B,[e[24]||(e[24]=l("h3",{class:"settings-section-title"},"Безопасность",-1)),l("div",{class:"form-group"},[e[22]||(e[22]=l("label",{class:"form-label"},"Сменить пароль",-1)),l("button",{class:"btn btn-outline",onClick:es},[...e[21]||(e[21]=[l("i",{class:"material-icons"},"lock",-1),o(" Изменить пароль ",-1)])])]),l("div",D,[e[23]||(e[23]=l("label",{class:"form-label"},"Активные сессии",-1)),l("div",A,[(t(!0),a(m,null,u(Q.value,(s,e)=>(t(),a("div",{key:e,class:"session-item"},[l("div",J,[l("span",N,i(s.device),1),l("span",T,i(s.ip),1),l("span",F,i(ss(s.last_active)),1)]),s.current?v("",!0):(t(),a("button",{key:0,class:"btn btn-sm btn-danger",onClick:e=>(async s=>{if(confirm("Вы уверены, что хотите завершить эту сессию?"))try{if(!(await fetch(`/api/auth/sessions/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${P.token}`}})).ok)throw new Error("Не удалось завершить сессию");Q.value=Q.value.filter(e=>e.id!==s),alert("Сессия успешно завершена")}catch(e){alert("Ошибка при завершении сессии")}})(s.id)}," Завершить ",8,G))]))),128))])])]),l("div",{class:"settings-section"},[e[29]||(e[29]=l("h3",{class:"settings-section-title"},"Данные и приватность",-1)),l("div",{class:"form-group"},[e[26]||(e[26]=l("label",{class:"form-label"},"Экспорт данных",-1)),l("button",{class:"btn btn-outline",onClick:as},[...e[25]||(e[25]=[l("i",{class:"material-icons"},"download",-1),o(" Скачать все данные ",-1)])])]),l("div",{class:"form-group"},[e[28]||(e[28]=l("label",{class:"form-label"},"Очистка истории",-1)),l("button",{class:"btn btn-danger",onClick:ts},[...e[27]||(e[27]=[l("i",{class:"material-icons"},"delete",-1),o(" Удалить всю историю чатов ",-1)])])])])]),l("div",{class:"card-footer"},[l("button",{class:"btn btn-primary",onClick:Z},[...e[30]||(e[30]=[l("i",{class:"material-icons"},"save",-1),o(" Сохранить изменения ",-1)])])])])]))}},[["__scopeId","data-v-5fed7606"]]);export{P as default};
